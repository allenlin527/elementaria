# 主線任務設計

## I. 設計理念與核心原則

根據遊戲世界觀和技術限制，主線任務設計遵循以下核心原則：

### 設計基礎
1. **元素進階模式**：每個區域專注於元素魔法系統的不同深度層面，從單一元素掌握到元素調和，再到最終的元素融合
2. **漸進式難度曲線**：任務難度呈階梯式增長，每個區域內保持平緩上升，區域間有明顯提升
3. **多人協作節點**：戰略性地在關鍵劇情點設計協作機會，但不強制多人參與
4. **資源優化設計**：任務相關資源按區域組織，支持動態載入，核心任務資源總體積控制在400KB以內

### 敘事結構
主線任務採用「英雄旅程」結構，分三個明確階段：
1. **覺醒**（和諧村）：發現元素力量與使命
2. **考驗**（元素混亂森林）：掌握元素調和，了解危機真相
3. **回歸**（遺忘神殿）：獲得最終力量，解決世界危機

## II. 任務流程與節奏設計

### 整體任務流程圖
```
[選擇主元素] → [和諧村基礎訓練] → [穩定村莊元素] → [元素調和啟蒙]
→ [探索混亂森林] → [尋找失蹤研究者] → [發現元素紊亂源頭] → [元素調和成長]
→ [進入遺忘神殿] → [通過四元素試煉] → [對抗扭曲者] → [修復元素核心] → [結局]
```

### 節奏設計
為創造動態節奏，主線任務交替使用四種任務類型：
1. **學習型**：獲取新知識、技能或元素理解（10-15分鐘）
2. **探索型**：尋找特定地點或物品（15-20分鐘）
3. **挑戰型**：測試玩家掌握的元素能力（10-15分鐘）
4. **協作型**：需要多人配合或不同元素互補（15-20分鐘）

每個區域內節奏設計：學習→探索→挑戰→協作→區域高潮

## III. 第一章：元素覺醒（和諧村）

### 核心目標
- 引導玩家理解元素系統基礎
- 建立角色在世界中的定位與使命
- 掌握基本元素魔法
- 初步體驗多人協作價值

### 任務1：「元素之聲」
**類型**：學習型
**時間**：10分鐘
**描述**：
- 玩家醒來在和諧村廣場，感受到異常的元素波動
- 與村長瑪蒂娜對話，了解世界元素失衡危機
- 完成元素親和測試，選擇主元素

**細節流程**：
1. 開場動畫展示元素混亂現象（CSS動畫，2KB）
2. 村長瑪蒂娜解釋世界觀與當前危機
3. 引導前往元素石，進行四種元素測試
4. 選擇主元素，獲得基礎元素石
5. 視覺呈現：選擇後角色周圍出現對應元素光環

**技術實現**：
- 使用CSS動畫呈現元素效果，減輕載入負擔
- 對話選項結果存儲在localStorage中
- 主元素選擇影響後續任務內容變體

### 任務2：「初學者的指引」
**類型**：學習型
**時間**：15分鐘
**描述**：
- 前往元素守護者奧林的工作室
- 學習基本元素控制
- 完成三個元素魔法練習

**細節流程**：
1. 奧林介紹元素基礎理論
2. 教授第一個基本元素魔法（基於玩家選擇）
   - 火：火球術
   - 水：水流控制
   - 風：疾風推動
   - 土：塑土成形
3. 引導完成三個基礎練習：
   - 目標練習：擊中/移動特定目標
   - 強度練習：控制元素力量大小
   - 持續練習：維持元素效果特定時間
4. 獎勵：提升主元素親和力+10

**技術實現**：
- 使用簡化版ThreeJS效果展示元素魔法，低性能設備降級為CSS效果
- 設置循序漸進的教程提示系統
- 使用WebSocket同步周圍其他玩家的練習效果

### 任務3：「村莊的煩惱」
**類型**：探索型
**時間**：15分鐘
**描述**：
- 村長請求幫助解決村莊中的三個元素異常
- 每個位置需要特定元素技能才能解決

**細節流程**：
1. 村長標記地圖上三個問題區域
2. 根據玩家主元素，提供主要解決方向（但鼓勵嘗試其他方法）:
   - **水井污染**：需水元素淨化或火元素蒸餾
   - **農田凋零**：需土元素穩固或水元素滋潤
   - **風暴來襲**：需風元素引導或土元素屏障
3. 玩家需找到解決每個問題的方法，可能需要其他元素使用者協助
4. 解決所有問題後回報村長

**技術實現**：
- 每個問題區域單獨載入資源
- 使用事件廣播系統，其他玩家的元素效果可被看見
- 同一區域玩家自動顯示主元素標誌，便於尋找協作者

### 任務4：「元素之間」
**類型**：協作型
**時間**：20分鐘
**描述**：
- 發現單一元素無法完全解決村莊中心的元素漩渦
- 需要學習元素調和或與其他元素使用者協作

**細節流程**：
1. 村莊中心出現大型元素漩渦，單一元素無法穩定
2. 奧林解釋元素調和理論，引導玩家:
   - 單人模式：從奧林處借用第二元素力量（較弱但可行）
   - 多人模式：與其他元素使用者站在特定位置同時施法
3. 完成元素共鳴儀式，穩定漩渦
4. 獲得元素調和初階知識，解鎖第二元素基礎技能

**技術實現**：
- 使用WebSocket同步多人共同施法效果
- 設計簡單的位置協作機制，玩家需站在特定位置
- 儀式成功時加載華麗但輕量的CSS過渡效果

### 章節高潮：「預言之門」
**類型**：挑戰型
**時間**：15分鐘
**描述**：
- 村長帶領前往村莊邊緣古老神社
- 挑戰需證明元素掌控能力的試煉

**細節流程**：
1. 神社大門被四色元素封印鎖住
2. 需完成四個元素挑戰，每個對應一種元素：
   - 火之試煉：點燃特定順序的火盆
   - 水之試煉：引導水流通過迷宮
   - 風之試煉：利用氣流攜帶物品越過障礙
   - 土之試煉：創建通路跨越裂縫
3. 通過試煉後，門開啟顯示通往森林的路徑
4. 瑪蒂娜分享古老預言，暗示元素使者的使命

**技術實現**：
- 試煉區設計為獨立場景，動態載入
- 使用簡化物理系統計算元素魔法效果
- 通過試煉後預載下一區域基本資源

## IV. 第二章：元素失控（元素混亂森林）

### 核心目標
- 深化元素調和系統理解
- 提供更有挑戰性的元素應用場景
- 揭示世界危機的真相
- 強化角色與目標的情感連接

### 任務1：「林間迷途」
**類型**：探索型
**時間**：15分鐘
**描述**：
- 玩家進入元素混亂森林，發現環境高度不穩定
- 需尋找森林守護者伊莉絲

**細節流程**：
1. 進入森林後，發現多條路徑被元素紊亂阻斷
2. 需使用已習得的元素能力清除障礙：
   - 倒塌的巨樹（需火焚或風推）
   - 劇毒沼澤（需土壓或水淨）
   - 元素迷霧（需風散或火熱）
3. 找到隱居處的伊莉絲，了解森林狀況
4. 伊莉絲請求調查三處嚴重的元素異常點

**技術實現**：
- 使用區域迷霧效果隱藏未載入區域
- 根據玩家清除障礙的方法記錄元素偏好
- 動態調整後續任務中的提示與建議

### 任務2：「元素失控點」
**類型**：挑戰型
**時間**：20分鐘
**描述**：
- 調查三處元素失控點，收集異常樣本
- 每處都有獨特的環境危險和元素失控生物

**細節流程**：
1. 伊莉絲提供三個失控點位置，可自由選擇順序
2. 各失控點特色：
   - **火元素亂流**：林地自燃，火元素生物攻擊性強
   - **水元素污染**：扭曲水流，水生物變異
   - **風元素漩渦**：破壞性氣流，懸浮碎片危險
3. 每處需收集元素樣本，要求特定元素技能配合
4. 收集過程中遭遇元素生物，需使用元素相克制服

**技術實現**：
- 元素生物使用簡化AI系統，對特定元素做出反應
- 使用粒子系統展示元素異常效果，但可降級
- 同一區域玩家可看到彼此與元素生物互動

### 任務3：「失落的研究者」
**類型**：探索型
**時間**：15分鐘
**描述**：
- 尋找在森林深處失蹤的元素研究者洛恩
- 解碼他留下的元素符文線索

**細節流程**：
1. 伊莉絲分析樣本後，發現符合洛恩研究痕跡
2. 引導玩家尋找洛恩可能的位置
3. 發現洛恩留下的元素符文線索，需用元素力量激活
4. 元素符文形成路徑，引導至隱藏洞穴
5. 發現洛恩被困，周圍元素力場不穩定

**技術實現**：
- 符文線索使用簡單的序列解謎系統
- 洞穴使用有限視距技術，降低資源需求
- 可選多人解謎，提升激活速度與準確性

### 任務4：「混沌中的真相」
**類型**：學習型
**時間**：15分鐘
**描述**：
- 解救洛恩並修復他的研究設備
- 分析元素樣本，發現元素紊亂原因

**細節流程**：
1. 幫助洛恩穩定周圍元素力場：
   - 需要四種元素力量精確平衡
   - 單人模式：使用洛恩的裝置輔助
   - 多人模式：不同元素使用者協作
2. 修復研究設備，每部分需特定元素技能
3. 分析元素樣本，發現元素相生相剋的深層規律
4. 洛恩解釋元素紊亂源頭可能在古代神殿

**技術實現**：
- 設備修復使用簡單的模式匹配謎題
- 樣本分析顯示四元素循環動畫（CSS實現）
- 對話中嵌入關鍵知識點，玩家需選擇正確理解

### 任務5：「元素漩渦之眼」
**類型**：協作型
**時間**：20分鐘
**描述**：
- 森林中心出現巨型元素漩渦，威脅整個區域
- 需應用新習得的元素調和知識穩定漩渦

**細節流程**：
1. 伊莉絲和洛恩帶領前往森林中心巨型漩渦
2. 洛恩解釋需激活四個元素節點形成穩定網絡
3. 協作需求：
   - 單人模式：依次激活節點，洛恩提供輔助
   - 多人模式：同時激活不同節點，效果更強
4. 完成后漩渦縮小但未消失，洛恩解釋需更強力量
5. 獲得元素調和石，提升跨元素能力

**技術實現**：
- 漩渦使用ThreeJS效果，但有CSS降級方案
- 節點激活使用計時系統，多人同步帶來加成
- 成功穩定後預載下一章節關鍵資源

### 章節高潮：「神殿的召喚」
**類型**：挑戰型
**時間**：15分鐘
**描述**：
- 穩定漩渦後發現通往遺忘神殿的古老傳送門
- 需通過守護者的最終考驗才能通過

**細節流程**：
1. 洛恩解讀古代銘文，解釋通過條件
2. 傳送門需四種元素力量精確序列激活
3. 出現元素幻象守護者，測試玩家元素掌控
4. 通過複雜元素序列挑戰（記憶+反應）
5. 傳送門開啟，顯示通往神殿的路徑

**技術實現**：
- 元素序列挑戰使用前端動畫和反應測試
- 記錄玩家完成時間和準確度，影響后續獎勵
- 傳送效果使用簡化粒子系統，可降級為CSS動畫

## V. 第三章：最終調和（遺忘神殿）

### 核心目標
- 測試玩家對全部元素系統的掌握
- 提供協作解決問題的高潮體驗
- 完成故事弧線，提供情感滿足的結局
- 留下擴展可能性

### 任務1：「神殿的歡迎」
**類型**：探索型
**時間**：15分鐘
**描述**：
- 進入古老的遺忘神殿，發現外觀與傳說不符
- 尋找神殿守護者阿薩

**細節流程**：
1. 傳送至神殿前廳，環境呈現嚴重元素紊亂
2. 探索前廳，發現四元素標記的通道
3. 根據元素標記線索，找出正確路徑
4. 發現元素封印室，阿薩出現並解釋情況
5. 阿薩提出進入神殿核心的條件：通過四元素試煉

**技術實現**：
- 神殿使用有限視距和局部細節技術節省資源
- 只載入玩家當前可見區域的高細節資源
- 阿薩使用動態對話系統，根據玩家之前選擇調整內容

### 任務2：「四元素之門」
**類型**：挑戰型
**時間**：25分鐘
**描述**：
- 需通過四個元素門，每扇都測試不同元素掌握度
- 門的順序依據元素相生相剋理論安排

**細節流程**：
1. 阿薩引導至四元素門前，解釋試煉規則
2. 每扇門需使用特定元素魔法解開封印：
   - **火之門**：需精確控溫，不同目標需不同熱度
   - **水之門**：需引導水流穿過複雜管道系統
   - **風之門**：需控制風力強度通過平衡挑戰
   - **土之門**：需塑造特定形狀填補機關缺口
3. 門的難度遞增，後兩門可能需元素組合技能
4. 通過所有門後，開啟通往神殿核心的路徑

**技術實現**：
- 每扇門使用獨立的謎題系統，可單獨載入
- 謎題使用前端物理引擎的簡化版本計算
- 記錄玩家解謎方法，影響最終對抗策略提示

### 任務3：「元素之心」
**類型**：學習型
**時間**：15分鐘
**描述**：
- 到達神殿核心，發現元素融合裝置
- 學習終極元素調和技術

**細節流程**：
1. 阿薩引導至神殿中央，展示古代元素融合裝置
2. 解釋元素平衡的真正意義：不是隔離而是融合
3. 傳授元素融合技術：
   - 同時引導多元素力量流動
   - 理解元素間的和諧共振點
   - 創造元素間的平衡結構
4. 練習基礎元素融合，創造複合元素效果
5. 突然察覺異常能量波動，神殿深處有人

**技術實現**：
- 元素融合效果使用顏色混合動畫展示
- 使用簡化的模式匹配系統練習融合
- 融合成功率根據之前任務表現動態調整

### 任務4：「真相揭露」
**類型**：協作型
**時間**：15分鐘
**描述**：
- 發現神殿深處的扭曲者正吸收失衡元素力量
- 了解扭曲者的真實身份與動機

**細節流程**：
1. 追隨能量波動至神殿深層封印室
2. 發現扭曲者（前任元素守護者）正破壞封印
3. 阿薩嘗試阻止但被擊退，玩家需保護阿薩
4. 對抗過程中扭曲者解釋動機：
   - 認為元素隔離才是真正平衡
   - 計劃重塑世界元素結構
5. 玩家需共同維持防護罩（需多元素協作）

**技術實現**：
- 扭曲者使用簡化AI系統，攻擊模式根據玩家元素調整
- 防護罩強度基於參與玩家數量和元素多樣性
- 使用WebSocket即時同步多玩家協作效果

### 任務5：「元素融合」
**類型**：協作型
**時間**：20分鐘
**描述**：
- 最終對抗扭曲者，需使用元素融合之力
- 合力修復被破壞的元素封印

**細節流程**：
1. 扭曲者攻擊加劇，需調整策略
2. 阿薩指引玩家站在四元素法陣上：
   - 單人模式：在法陣間移動，依次激活
   - 多人模式：不同玩家站在對應主元素位置
3. 同時引導元素力量對抗扭曲者
4. 關鍵時刻需做出選擇：
   - 淨化扭曲者（更難但正面結局）
   - 封印扭曲者（較簡單但留下隱患）
5. 成功後元素平衡開始恢復

**技術實現**：
- 使用CSS Grid系統創建元素法陣位置
- 實時計算玩家位置與法陣的重合度
- 根據玩家選擇載入不同結局資源

### 章節高潮：「平衡新生」
**類型**：儀式型
**時間**：10分鐘
**描述**：
- 完成最終元素融合，恢復世界平衡
- 見證元素和諧的重建

**細節流程**：
1. 阿薩引導完成最終元素融合儀式
2. 所有玩家需貢獻主元素能量：
   - 單人模式：使用遺物放大能量
   - 多人模式：每人提供一種元素
3. 創造元素融合光束，修復世界元素網絡
4. 神殿開始變化，展現真正的輝煌形態
5. 阿薩授予「元素調和者」稱號，暗示未來挑戰

**技術實現**：
- 使用預渲染動畫展示世界恢復場景
- 根據玩家貢獻計算個人成就和稱號
- 使用WebSocket廣播完成信息至同區域玩家

## VI. 決策點與分支設計

### 關鍵決策點

設計五個重要決策點，影響遊戲體驗但不大幅增加開發複雜度：

1. **元素選擇**（和諧村）
   - 選擇主元素影響整體遊戲風格和解謎方式
   - 技術實現：模塊化內容，只替換關鍵提示和對話

2. **問題解決方法**（和諧村）
   - 使用不同元素解決村莊問題影響NPC反應
   - 技術實現：簡單變量追蹤，修改後續對話文本

3. **洛恩救援方法**（元素混亂森林）
   - 選擇救援策略影響獲得的知識類型
   - 技術實現：解鎖不同元素組合技能路徑

4. **神殿試煉順序**（遺忘神殿）
   - 選擇門的通過順序影響難度和獲得的洞見
   - 技術實現：調整後續試煉難度係數

5. **扭曲者命運**（遺忘神殿）
   - 淨化或封印選擇影響結局和未來擴展
   - 技術實現：載入不同結局資源，存儲結局標記

### 分支合流設計

為避免內容爆炸，採用「管道式」分支設計：

```
     [分支A1] → [分支A2]
    /                    \
[起點] → [分支B1] → [分支B2] → [合流點] → [共同結局]
    \                    /
     [分支C1] → [分支C2]
```

技術實現：
- 使用狀態標記系統記錄玩家選擇
- 合流點調整對話和提示，反映之前的選擇
- 結局場景包含微小變化，反映關鍵決策

## VII. 獎勵系統與進展感

### 任務獎勵結構

每個主要任務完成後提供多層次獎勵：

1. **能力獎勵**：
   - 元素親和力提升（+5-10點）
   - 新魔法技能解鎖（每章至少1個）
   - 元素調和能力增強

2. **知識獎勵**：
   - 元素相關知識點（解鎖對話選項）
   - 世界觀背景揭示（增加沉浸感）
   - 角色背景故事片段

3. **視覺獎勵**：
   - 角色外觀微妙變化（元素光環強化）
   - 魔法效果視覺升級（更華麗的施法效果）
   - 成就標記（在玩家名稱旁顯示）

### 進展可視化

為增強進展感，實施以下可視化元素：

1. **任務進度儀表板**：
   - 簡潔顯示主線完成度
   - 未來任務以問號顯示，避免過度劇透
   - 章節總結獲得的能力與知識

2. **元素掌握度可視化**：
   - 四元素掌握度雷達圖
   - 技能解鎖進度條
   - 元素調和能力視覺表示

3. **世界狀態變化**：
   - 區域環境隨任務進展變化（元素平衡恢復）
   - NPC反應和對話變化
   - 可訪問區域擴展

## VIII. 多人協作整合

### 協作設計理念

主線任務中的多人元素遵循三原則：

1. **增強但非必須**：所有任務可單人完成，多人僅提供便利和增強
2. **自然整合**：協作是故事和機制的自然延伸，非強制添加
3. **低門檻高天花板**：基本協作簡單直觀，高級協作帶來額外收益

### 關鍵協作節點

主線中設置五個關鍵協作機會：

1. **和諧村元素漩渦**（第一章）
   - 不同元素玩家環繞漩渦，同時施法
   - 單人替代：使用村長提供的輔助道具

2. **元素失控點清理**（第二章）
   - 不同元素玩家對應不同威脅類型
   - 單人替代：逐一處理，耗時更長

3. **元素漩渦穩定**（第二章）
   - 多玩家同時激活四個節點
   - 單人替代：依次激活，效果較弱

4. **四元素門同步開啟**（第三章）
   - 不同元素玩家同時施法開啟大門
   - 單人替代：使用阿薩的元素放大器

5. **最終元素融合**（第三章）
   - 站在對應元素位置共同引導能量
   - 單人替代：在位置間移動，難度更高

### 協作獎勵機制

為鼓勵多人協作，提供特殊獎勵：

1. **元素共鳴獎勵**：
   - 與不同元素玩家協作積累共鳴度
   - 達到閾值解鎖特殊共鳴視覺效果

2. **協作速度加成**：
   - 多人協作完成任務速度更快
   - 節省時間轉化為額外元素親和力獎勵

3. **獨特協作成就**：
   - 完成特定多人任務獲得獨特稱號
   - 玩家名片顯示協作成就標誌

## IX. 技術實現與資源優化

### 任務資源組織

按區域和任務類型組織資源，確保優化載入：

```javascript
// 資源組織示例
const questResources = {
    village: {
        core: ['village_base.json', 'village_npc.json'], // 280KB
        quest1: ['village_q1_dialogues.json', 'element_test.json'], // 40KB
        quest2: ['element_tutorial.json', 'spell_effects.json'], // 65KB
        quest3: ['village_problems.json', 'element_interactions.json'], // 50KB
        quest4: ['harmony_ritual.json'], // 35KB
    },
    forest: {
        core: ['forest_base.json', 'forest_npc.json'], // 310KB
        quest1: ['forest_paths.json', 'forest_obstacles.json'], // 55KB
        // 其他資源...
    },
    temple: {
        core: ['temple_base.json', 'temple_npc.json'], // 290KB
        // 其他資源...
    }
};
```

### 載入策略

實施智能載入策略降低資源消耗：

1. **預載基礎資源**：
   - 當前區域核心資源（地圖、基本NPC）
   - 即將進行任務的對話和基本機制

2. **動態載入任務資源**：
   - 任務開始前加載特定資源
   - 完成後釋放非共用資源

3. **預測性載入**：
   - 根據玩家位置和行動預測下一步
   - 利用空閒時間預載可能需要的資源

### 多人同步優化

為降低網絡負擔，精簡同步數據：

1. **位置同步**：
   - 只同步大致位置和朝向（降低精度）
   - 使用運動預測減少更新頻率

2. **行動同步**：
   - 只同步關鍵行動和結果，不同步過程
   - 使用事件驅動模式而非狀態輪詢

3. **效果同步**：
   - 本地計算視覺效果，只同步結果
   - 使用標準化效果模板減少傳輸數據

## X. MVP實施路線圖

### 優先級排序

根據資源限制，確定主線任務優先實施順序：

1. **核心體驗（必須實現）**：
   - 和諧村完整主線（4個任務）
   - 基本元素選擇與魔法系統
   - 簡化版多人可見性

2. **擴展體驗（次優先）**：
   - 元素混亂森林前三個任務
   - 基本元素調和系統
   - 多人協作基礎功能

3. **完整體驗（理想目標）**：
   - 全部三章主線內容
   - 完整元素融合系統
   - 多人協作高級功能

### 階段實施計劃

遵循週期性增量原則，確保隨時可發布：

#### 第一階段（2週）
- 實現和諧村「元素之聲」與「初學者的指引」任務
- 基本元素選擇與第一個元素技能
- 基礎對話系統與NPC互動

#### 第二階段（2週）
- 完成和諧村剩餘任務
- 實現基本多人可見性和簡單互動
- 添加元素親和力進展系統

#### 第三階段（3週）
- 實現元素混亂森林前三個任務
- 完善元素調和系統
- 加強多人協作功能

#### 第四階段（3週）
- 完成森林剩餘任務和神殿章節
- 實現元素融合系統
- 完善結局和分支選擇

---

此主線任務設計在確保技術可行性的前提下，創造了一個完整的元素魔法冒險旅程。通過精心設計的任務節奏、協作機會和進展系統，即使在輕量級網頁遊戲的限制下，也能提供深度的遊戲體驗和情感滿足的故事弧線。實施策略的模塊化設計確保了即使在資源有限的情況下，也能優先交付核心體驗，同時為未來擴展留下空間。